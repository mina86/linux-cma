% Copyright (c) 2012 by Michał Nazarewicz <mina86@mina86.com>
% Distributed under the terms of the Creative Commons
% Attribution-ShareAlike 3.0 Unported (CC BY-SA 3.0) license.

\subsection{Implementacja CMA}

\begin{frame}[fragile]
  \frametitle{Interakcja CMA z~innymi alokatorami}

  \begin{center}
    \includegraphics<1>[width=\textwidth]{build/linux-allocators--important.eps}
    \includegraphics<2>[width=\textwidth]{build/linux-allocators--cma.eps}
  \end{center}
\end{frame}

\begin{frame}
  \frametitle{Integracja z~DMA API}

  \begin{itemize}
  \item DMA API umożliwia alokowanie buforów DMA.
  \item Implementacja zależna od architektury.
  \item Funkcje DMA API danej architektury muszą być zmodyfikowane
    by wołać CMA.
  \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{Rezerwacja regionów CMA}

  \begin{itemize}
  \item Przy starcie, CMA rezerwuje pamięć z~memblock.
    \begin{itemize}
    \item Zarezerwowany obszar nazywa się regionem lub kontekstem.
    \end{itemize}
  \item Przygotowany region jest zwracany do puli alokatora stron.
  \item Kontekst posiada bitmapę stron niezaalokowanych przez CMA.
  \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{Typ migracji CMA}

  \begin{itemize}
  \item CMA migruje wiele stron na raz.
    \begin{itemize}
    \item Dostępne typy migracji nie gwarantują ciągłości.
    \end{itemize}
  \item Nowy typ migracji: \textit{cma}.
  \item Blok stron tego typu:
    \begin{itemize}
    \item nigdy nie zmienia typu, oraz
    \item alokator stron alokuje z~niego tylko strony ruchome.
    \end{itemize}
  \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{Algorytm alokacji}

  \begin{center}
    \includegraphics[width=\textwidth]{build/cma-alloc-algo.eps}
  \end{center}

\end{frame}
